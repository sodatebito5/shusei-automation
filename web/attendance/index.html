<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å‡ºæ¬ ç¢ºèª</title>

  <!-- Preconnect for faster resource loading -->
  <link rel="preconnect" href="https://static.line-scdn.net">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Google Fonts (optimized: fewer weights + swap) -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600&family=Outfit:wght@600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600&family=Outfit:wght@600;700&display=swap" rel="stylesheet"></noscript>

  <!-- LIFF SDK (async loading) -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js" async></script>

  <style>
    :root {
      --color-primary: #00a960;
      --color-primary-light: #00c96b;
      --color-primary-dark: #008f52;
      --color-accent: #ff6b6b;
      --color-accent-soft: #ffb4b4;
      --color-surface: rgba(255, 255, 255, 0.82);
      --color-surface-solid: #ffffff;
      --color-text: #1a2e1a;
      --color-text-secondary: #5a6b5a;
      --color-text-muted: #8a9b8a;
      --gradient-bg: linear-gradient(145deg, #e8f5e9 0%, #c8e6c9 30%, #a5d6a7 70%, #81c784 100%);
      --gradient-btn: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
      --shadow-card: 0 8px 32px rgba(0, 80, 40, 0.12), 0 2px 8px rgba(0, 0, 0, 0.04);
      --shadow-btn: 0 4px 16px rgba(0, 169, 96, 0.35);
      --shadow-btn-hover: 0 6px 24px rgba(0, 169, 96, 0.45);
      --radius-lg: 24px;
      --radius-md: 16px;
      --radius-sm: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--gradient-bg);
      min-height: 100vh;
      min-height: 100dvh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    /* èƒŒæ™¯è£…é£¾ */
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      right: -30%;
      width: 80%;
      height: 80%;
      background: radial-gradient(circle, rgba(255,255,255,0.4) 0%, transparent 70%);
      pointer-events: none;
      animation: floatBg 20s ease-in-out infinite;
    }

    body::after {
      content: '';
      position: fixed;
      bottom: -30%;
      left: -20%;
      width: 60%;
      height: 60%;
      background: radial-gradient(circle, rgba(0,169,96,0.15) 0%, transparent 60%);
      pointer-events: none;
      animation: floatBg 15s ease-in-out infinite reverse;
    }

    @keyframes floatBg {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(20px, 30px) scale(1.05); }
    }

    /* ã‚«ãƒ¼ãƒ‰ */
    .container {
      background: var(--color-surface);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      padding: 36px 28px 32px;
      border-radius: var(--radius-lg);
      width: 100%;
      max-width: 380px;
      box-shadow: var(--shadow-card);
      border: 1px solid rgba(255, 255, 255, 0.6);
      position: relative;
      z-index: 1;
      animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆä¸­å¤®æƒãˆï¼‰ */
    .header-section {
      text-align: center;
      margin-bottom: 8px;
    }

    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 16px;
      border-radius: 50px;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 20px;
      transition: all 0.3s ease;
    }

    .status-badge.loading {
      background: #f5f5f5;
      color: var(--color-text-muted);
    }

    .status-badge.answered {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      color: var(--color-primary-dark);
      border: 1px solid rgba(0, 169, 96, 0.2);
    }

    .status-badge.unanswered {
      background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
      color: #e65100;
      border: 1px solid rgba(230, 81, 0, 0.2);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    .status-badge .icon {
      font-size: 16px;
    }

    /* ã‚¿ã‚¤ãƒˆãƒ« */
    .event-title {
      font-family: 'Outfit', 'Noto Sans JP', sans-serif;
      font-size: 28px;
      font-weight: 700;
      color: var(--color-text);
      margin-bottom: 28px;
      letter-spacing: -0.02em;
      line-height: 1.3;
    }

    .event-title .month {
      color: var(--color-primary);
    }

    /* ãƒœã‚¿ãƒ³å…±é€š */
    .btn {
      width: 100%;
      border: none;
      border-radius: var(--radius-md);
      font-family: 'Noto Sans JP', sans-serif;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(rgba(255,255,255,0.2), transparent);
      opacity: 0;
      transition: opacity 0.25s;
    }

    .btn:active::before {
      opacity: 1;
    }

    /* å‡ºå¸­ãƒœã‚¿ãƒ³ */
    .btn-attend {
      background: var(--gradient-btn);
      color: #fff;
      padding: 22px 24px;
      font-size: 18px;
      box-shadow: var(--shadow-btn);
      margin-bottom: 14px;
    }

    .btn-attend:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-btn-hover);
    }

    .btn-attend:active {
      transform: translateY(0) scale(0.98);
    }

    .btn-attend .icon {
      font-size: 22px;
    }

    /* æ¬ å¸­ãƒœã‚¿ãƒ³ */
    .btn-absent {
      background: var(--color-surface-solid);
      color: var(--color-text-secondary);
      padding: 16px 20px;
      font-size: 15px;
      border: 1.5px solid #e0e0e0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }

    .btn-absent:hover {
      background: #fafafa;
      border-color: var(--color-accent-soft);
      color: var(--color-accent);
    }

    .btn-absent:active {
      transform: scale(0.98);
    }

    /* ãƒ–ãƒ¼ã‚¹å‡ºåº—ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .booth-section {
      margin-top: 28px;
      padding-top: 24px;
      border-top: 1px solid rgba(0, 0, 0, 0.06);
      text-align: center;
    }

    .booth-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--color-text);
      margin-bottom: 14px;
    }

    .booth-title .icon {
      font-size: 18px;
    }

    .booth-options {
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .booth-option {
      flex: 1;
      position: relative;
    }

    .booth-option input {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .booth-option label {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 14px 12px;
      background: var(--color-surface-solid);
      border: 2px solid #e8e8e8;
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-weight: 600;
      color: var(--color-text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .booth-option input:checked + label {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      border-color: #2196f3;
      color: #1565c0;
    }

    .booth-option label:hover {
      border-color: #bdbdbd;
    }

    .booth-option input:checked + label:hover {
      border-color: #2196f3;
    }

    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
    .loading-text {
      text-align: center;
      color: var(--color-text-muted);
      font-size: 14px;
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .loading-spinner {
      width: 18px;
      height: 18px;
      border: 2px solid #e0e0e0;
      border-top-color: var(--color-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* å®Œäº†ç”»é¢ */
    .result-container {
      text-align: center;
    }

    .result-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 24px;
      background: var(--gradient-btn);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 32px rgba(0, 169, 96, 0.3);
      animation: scaleIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.5);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .result-icon .checkmark {
      width: 36px;
      height: 36px;
      stroke: white;
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
    }

    .result-icon .checkmark path {
      stroke-dasharray: 48;
      stroke-dashoffset: 48;
      animation: drawCheck 0.4s ease-out 0.3s forwards;
    }

    @keyframes drawCheck {
      to { stroke-dashoffset: 0; }
    }

    .result-title {
      font-family: 'Outfit', 'Noto Sans JP', sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: var(--color-primary);
      margin-bottom: 8px;
    }

    .result-subtitle {
      font-size: 14px;
      color: var(--color-text-secondary);
      margin-bottom: 24px;
    }

    .result-card {
      background: #f8faf8;
      border-radius: var(--radius-md);
      padding: 20px;
      margin-bottom: 24px;
      border: 1px solid rgba(0, 169, 96, 0.1);
    }

    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
    }

    .result-item:not(:last-child) {
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .result-label {
      font-size: 13px;
      color: var(--color-text-muted);
    }

    .result-value {
      font-size: 15px;
      font-weight: 600;
      color: var(--color-text);
    }

    .result-value.attend {
      color: var(--color-primary);
    }

    .result-value.absent {
      color: var(--color-accent);
    }

    /* é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ */
    .btn-close {
      background: #f5f5f5;
      color: var(--color-text-secondary);
      padding: 16px 24px;
      font-size: 15px;
    }

    .btn-close:hover {
      background: #eeeeee;
    }

    /* éè¡¨ç¤º */
    .hidden {
      display: none !important;
    }

    /* ç´™å¹é›ª */
    .confetti {
      position: fixed;
      pointer-events: none;
      z-index: 100;
    }

    .confetti-piece {
      position: absolute;
      width: 10px;
      height: 10px;
      background: var(--color-primary);
      animation: confettiFall 3s ease-out forwards;
    }

    .confetti-piece:nth-child(odd) {
      background: #ffd54f;
    }

    .confetti-piece:nth-child(3n) {
      background: #ff8a65;
    }

    @keyframes confettiFall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
  </style>
</head>

<body>

  <!-- é¸æŠç”»é¢ -->
  <div id="selectScreen" class="container">
    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
    <div class="header-section">
      <div id="prevStatus" class="status-badge unanswered">
        <span class="icon">ğŸ“</span>
        <span>å‡ºæ¬ ã‚’å›ç­”ã—ã¦ãã ã•ã„</span>
      </div>

      <!-- ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¾ãŸã¯APIå–å¾—å¾Œã«è¡¨ç¤ºï¼‰ -->
      <h1 id="eventTitle" class="event-title">ä¾‹ä¼šã«</h1>
    </div>

    <!-- å‡ºå¸­ãƒœã‚¿ãƒ³ -->
    <button class="btn btn-attend" onclick="submitStatus('å‡ºå¸­')">
      å‡ºå¸­ã—ã¾ã™ï¼
    </button>

    <!-- æ¬ å¸­ãƒœã‚¿ãƒ³ -->
    <button class="btn btn-absent" onclick="submitStatus('æ¬ å¸­')">
      æ¬ å¸­ã—ã¾ã™
    </button>

    <!-- 2éƒ¨ä¼šï¼ˆæ‡‡è¦ªä¼šï¼‰ -->
    <div class="booth-section">
      <div class="booth-title">2éƒ¨ä¼šï¼ˆæ‡‡è¦ªä¼šï¼‰</div>
      <div class="booth-options">
        <div class="booth-option">
          <input type="radio" name="afterParty" id="afterPartyYes" value="å‚åŠ ã™ã‚‹">
          <label for="afterPartyYes">å‚åŠ ã™ã‚‹</label>
        </div>
        <div class="booth-option">
          <input type="radio" name="afterParty" id="afterPartyNo" value="å‚åŠ ã—ãªã„">
          <label for="afterPartyNo">å‚åŠ ã—ãªã„</label>
        </div>
      </div>
    </div>

    <!-- ãƒ–ãƒ¼ã‚¹å‡ºåº— -->
    <div class="booth-section">
      <div class="booth-title">ãƒ–ãƒ¼ã‚¹å‡ºåº—</div>

      <div class="booth-options">
        <div class="booth-option">
          <input type="radio" name="booth" id="boothYes" value="å‡ºåº—ã—ãŸã„ã§ã™ã€‚">
          <label for="boothYes">å‡ºåº—ã™ã‚‹</label>
        </div>
        <div class="booth-option">
          <input type="radio" name="booth" id="boothNo" value="å‡ºåº—ã—ã¾ã›ã‚“ã€‚" checked>
          <label for="boothNo">å‡ºåº—ã—ãªã„</label>
        </div>
      </div>
    </div>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
    <div id="loading" class="loading-text hidden">
      <div class="loading-spinner"></div>
      <span>é€ä¿¡ä¸­...</span>
    </div>
  </div>

  <!-- å®Œäº†ç”»é¢ -->
  <div id="resultScreen" class="container hidden">
    <div class="result-container">
      <!-- ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ -->
      <div class="result-icon">
        <svg class="checkmark" viewBox="0 0 36 36">
          <path d="M8 18 L15 25 L28 11" />
        </svg>
      </div>

      <h1 class="result-title">å›ç­”å®Œäº†ï¼</h1>
      <p class="result-subtitle">ã”å›ç­”ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™</p>

      <!-- å›ç­”å†…å®¹ -->
      <div class="result-card">
        <div class="result-item">
          <span class="result-label">å‡ºæ¬ </span>
          <span id="resultStatus" class="result-value">-</span>
        </div>
        <div class="result-item">
          <span class="result-label">ãƒ–ãƒ¼ã‚¹å‡ºåº—</span>
          <span id="resultBooth" class="result-value">-</span>
        </div>
        <div class="result-item">
          <span class="result-label">2éƒ¨ä¼š</span>
          <span id="resultAfterParty" class="result-value">-</span>
        </div>
      </div>

      <button class="btn btn-close" onclick="closeLiff()">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <script>
    const LIFF_ID = '2008446831-256wkWVY';
    const GAS_URL = 'https://script.google.com/macros/s/AKfycby-rXLMy1lKIhyl60ZaS_tCob20cAuCgrkzf9B0Ky738DyvTWNBh_7AuDb1iNrEhf7ElA/exec';
    const CACHE_KEY = 'attendance_cache';

    let profile = null;

    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰åˆæœŸè¡¨ç¤ºï¼ˆå³åº§ã«å®Ÿè¡Œï¼‰
    function showFromCache() {
      try {
        const cache = JSON.parse(localStorage.getItem(CACHE_KEY));
        if (cache && cache.eventKey) {
          const match = cache.eventKey.match(/(\d+)æœˆä¾‹ä¼š/);
          if (match) {
            document.getElementById('eventTitle').innerHTML =
              `<span class="month">${match[1]}æœˆ</span>ä¾‹ä¼šã«`;
          }
          // å›ç­”çŠ¶æ³ã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰è¡¨ç¤º
          const el = document.getElementById('prevStatus');
          if (cache.status && cache.status !== 'æœªå›ç­”') {
            const boothText = cache.booth === 'â—‹' ? 'ãƒ»ãƒ–ãƒ¼ã‚¹å‡ºåº—' : '';
            const afterPartyText = cache.afterParty === 'â—‹' ? 'ãƒ»2éƒ¨ä¼šå‚åŠ ' : '';
            el.innerHTML = `<span class="icon">âœ…</span><span>${cache.status}ã§å›ç­”æ¸ˆã¿${boothText}${afterPartyText}</span>`;
            el.className = 'status-badge answered';
          }
        }
      } catch (e) { /* ignore */ }
    }
    showFromCache();

    // LIFF SDKã®èª­ã¿è¾¼ã¿ã‚’å¾…ã£ã¦ã‹ã‚‰åˆæœŸåŒ–
    function initApp() {
      if (typeof liff === 'undefined') {
        setTimeout(initApp, 50);
        return;
      }

      liff.init({ liffId: LIFF_ID })
        .then(() => {
          if (!liff.isLoggedIn()) return liff.login();
          return liff.getProfile();
        })
        .then(p => {
          profile = p;
          if (profile && profile.userId) {
            fetchPrevStatus(profile.userId);
          }
        })
        .catch(err => alert("LIFFã‚¨ãƒ©ãƒ¼: " + err));
    }

    // DOMContentLoadedå¾Œã«åˆæœŸåŒ–é–‹å§‹
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initApp);
    } else {
      initApp();
    }

    // å‰å›ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—
    function fetchPrevStatus(userId) {
      const url = GAS_URL + '?mode=getAttendanceStatus&userId=' + encodeURIComponent(userId);

      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            showPrevStatus(data.eventKey, data.status, data.booth, data.afterParty);
          }
        })
        .catch(err => console.log('å‰å›ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—ã‚¨ãƒ©ãƒ¼:', err));
    }

    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
    function showPrevStatus(eventKey, status, booth, afterParty) {
      const el = document.getElementById('prevStatus');
      const titleEl = document.getElementById('eventTitle');

      // eventKeyãŒãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      if (!eventKey) {
        el.innerHTML = '<span class="icon">âš ï¸</span><span>æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ</span>';
        el.className = 'status-badge unanswered';
        titleEl.textContent = 'ä¾‹ä¼šã«';
        return;
      }

      // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
      try {
        localStorage.setItem(CACHE_KEY, JSON.stringify({ eventKey, status, booth, afterParty }));
      } catch (e) { /* ignore */ }

      // eventKeyã‹ã‚‰ã€Œâ—‹æœˆä¾‹ä¼šã€éƒ¨åˆ†ã‚’æŠ½å‡º
      const match = eventKey.match(/(\d+)æœˆä¾‹ä¼š/);
      const monthNum = match ? match[1] : '';
      const monthText = match ? match[1] + 'æœˆä¾‹ä¼š' : eventKey;

      if (status === 'æœªå›ç­”') {
        el.innerHTML = '<span class="icon">ğŸ“</span><span>ã¾ã å›ç­”ã—ã¦ã„ã¾ã›ã‚“</span>';
        el.className = 'status-badge unanswered';
      } else {
        const boothText = booth === 'â—‹' ? 'ãƒ»ãƒ–ãƒ¼ã‚¹å‡ºåº—' : '';
        const afterPartyText = afterParty === 'â—‹' ? 'ãƒ»2éƒ¨ä¼šå‚åŠ ' : '';
        el.innerHTML = `<span class="icon">âœ…</span><span>${status}ã§å›ç­”æ¸ˆã¿${boothText}${afterPartyText}</span>`;
        el.className = 'status-badge answered';
      }

      // ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
      if (monthNum) {
        titleEl.innerHTML = `<span class="month">${monthNum}æœˆ</span>ä¾‹ä¼šã«`;
      } else {
        titleEl.textContent = monthText + 'ã«';
      }
    }

    // é€ä¿¡
    function submitStatus(status) {
      if (!profile) {
        alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã€‚å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      const boothInput = document.querySelector('input[name="booth"]:checked');
      const booth = boothInput ? boothInput.value : 'å‡ºåº—ã—ã¾ã›ã‚“ã€‚';
      const afterPartyInput = document.querySelector('input[name="afterParty"]:checked');
      if (!afterPartyInput) {
        alert('2éƒ¨ä¼šã®å‚åŠ è¡¨æ˜ã‚’ãŠé¡˜ã„ã—ã¾ã™');
        return;
      }
      const afterParty = afterPartyInput.value;

      document.getElementById("loading").classList.remove("hidden");

      const data = {
        userId: profile.userId,
        displayName: profile.displayName,
        status: status,
        booth: booth,
        afterParty: afterParty
      };

      fetch(GAS_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'text/plain' },
        body: JSON.stringify(data)
      })
      .then(() => showResult(status, booth, afterParty))
      .catch(err => alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼: " + err));
    }

    function showResult(status, booth, afterParty) {
      document.getElementById("selectScreen").classList.add("hidden");
      document.getElementById("resultScreen").classList.remove("hidden");

      // çµæœè¡¨ç¤º
      const statusEl = document.getElementById("resultStatus");
      statusEl.textContent = status;
      statusEl.className = 'result-value ' + (status === 'å‡ºå¸­' ? 'attend' : 'absent');

      document.getElementById("resultBooth").textContent =
        booth === 'å‡ºåº—ã—ãŸã„ã§ã™ã€‚' ? 'å‡ºåº—ã™ã‚‹' : 'å‡ºåº—ã—ãªã„';

      document.getElementById("resultAfterParty").textContent =
        afterParty === 'å‚åŠ ã™ã‚‹' ? 'å‚åŠ ã™ã‚‹' : 'å‚åŠ ã—ãªã„';

      // å‡ºå¸­ã®å ´åˆã¯ç´™å¹é›ª
      if (status === 'å‡ºå¸­') {
        createConfetti();
      }
    }

    function closeLiff() {
      liff.closeWindow();
    }

    // ç´™å¹é›ªã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
    function createConfetti() {
      const container = document.createElement('div');
      container.className = 'confetti';
      document.body.appendChild(container);

      for (let i = 0; i < 30; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.left = Math.random() * 100 + 'vw';
        piece.style.animationDelay = Math.random() * 0.5 + 's';
        piece.style.animationDuration = (2 + Math.random() * 2) + 's';
        container.appendChild(piece);
      }

      setTimeout(() => container.remove(), 4000);
    }
  </script>

</body>
</html>
