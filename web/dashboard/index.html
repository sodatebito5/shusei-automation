<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å®ˆæˆã‚¯ãƒ©ãƒ–ç¦å²¡é£¯å¡š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- ã‚¿ãƒ–ç”¨ã®ã‚·ãƒ³ãƒ—ãƒ«CSS -->
  <style>
    .tab-container {
      display: flex;
      gap: 8px;
      border-bottom: 1px solid #e5e7eb;
      padding: 8px 0;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    .tab-btn {
      border: none;
      padding: 6px 12px;
      border-radius: 999px;
      background: #e5e7eb;
      cursor: pointer;
      font-size: 14px;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: background 0.2s ease, transform 0.05s ease;
    }

    .tab-btn:hover {
      background: #d1d5db;
      transform: translateY(-1px);
    }

    .tab-btn.active {
      background: #2563eb;
      color: #fff;
    }

    .tab-panels {
      margin-top: 16px;
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    /* ===========================
       1äºº1ã‚«ãƒ¼ãƒ‰ç”¨ã®CSS
       =========================== */

    .member-card {
      border-radius: 0.5rem;
      border: 1px solid #e5e7eb;
      padding: 6px 10px;
      background-color: #ffffff;
      box-sizing: border-box;
    }

    .member-card__badge {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 9999px;
      display: inline-flex;
      align-items: center;
      gap: 2px;
      font-weight: 500;
      margin-bottom: 2px;
    }

    .member-card__name {
      font-size: 0.8rem;
      font-weight: 600;
      color: #111827;           /* slate-900 */
      line-height: 1.2;
      white-space: normal;
      overflow: visible;
      text-overflow: clip;
    }

    /* ã‚´ãƒ¼ãƒ«ãƒ‰ */
    .member-card--gold {
      border-color: #fbbf24;      /* amber-400 */
      background-color: #fffbeb;  /* amber-50 */
    }
    .member-card--gold .member-card__badge {
      background-color: #fef3c7;  /* amber-100 */
      color: #92400e;             /* amber-800 */
    }

    /* èµ¤ */
    .member-card--red {
      border-color: #fca5a5;      /* red-300 */
      background-color: #fef2f2;  /* red-50 */
    }
    .member-card--red .member-card__badge {
      background-color: #fee2e2;  /* red-100 */
      color: #b91c1c;             /* red-700 */
    }

    /* ç·‘ */
    .member-card--green {
      border-color: #6ee7b7;      /* emerald-300 */
      background-color: #ecfdf5;  /* emerald-50 */
    }
    .member-card--green .member-card__badge {
      background-color: #d1fae5;  /* emerald-100 */
      color: #065f46;             /* emerald-800 */
    }

    /* ãƒãƒƒã‚¸ãªã—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ */
    .member-card--default {
      border-color: #e5e7eb;
      background-color: #f9fafb;  /* slate-50 */
    }
    .member-card--default .member-card__badge {
      background-color: #e5e7eb;
      color: #374151;             /* slate-700 */
    }
  </style>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-100 text-slate-900">
  <div class="max-w-6xl mx-auto px-4 py-6 space-y-6">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="flex items-center justify-between">
      <div>
        <h1 class="text-xl md:text-2xl font-bold">
          å®ˆæˆã‚¯ãƒ©ãƒ– ç¦å²¡é£¯å¡š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
        </h1>
        <p class="text-sm text-slate-500 mt-1">
          ç¾åœ¨ã®ä¾‹ä¼šã®å‡ºæ¬ çŠ¶æ³ãƒ»å£²ä¸Šãƒ»ã‚²ã‚¹ãƒˆç”³è«‹ã®çŠ¶æ³ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
        </p>
      </div>
      <div class="text-right">
        <div class="text-xs text-slate-500">å¯¾è±¡ä¾‹ä¼š</div>
        <div id="eventName" class="text-sm font-semibold">-</div>
      </div>
    </header>

    <!-- ã‚¿ãƒ–ãƒœã‚¿ãƒ³ -->
    <div class="tab-container">
      <button class="tab-btn active" data-tab="summary-tab">ğŸ“Š æ¦‚è¦</button>
      <button class="tab-btn" data-tab="attend-tab">âœ… å‡ºæ¬ </button>
      <button class="tab-btn" data-tab="guest-tab">ğŸ‘¥ ã‚²ã‚¹ãƒˆ</button>
      <button class="tab-btn" data-tab="sales-tab">ğŸ’° å£²ä¸Š</button>
      <button class="tab-btn" data-tab="team-tab">ğŸ§© ãƒãƒ¼ãƒ </button>
      <button class="tab-btn" data-tab="renew-tab">ğŸ” æ›´æ–°</button>
    </div>

    <!-- ã‚¿ãƒ–ä¸­èº« -->
    <div class="tab-panels">
      <!-- ğŸ“Š æ¦‚è¦ã‚¿ãƒ– -->
      <div id="summary-tab" class="tab-panel active">
        <!-- ä»Šæœˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ -->
        <section class="bg-white rounded-xl shadow p-4 border border-slate-200 mb-4">
          <div class="text-base md:text-lg font-semibold mb-2">
            ä»Šæœˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
          </div>
          <div class="flex flex-wrap gap-x-6 gap-y-2 text-xs md:text-sm">
            <div>
              [ å‚åŠ ç‡
              <span id="highlightAttendRate" class="text-xl md:text-2xl font-extrabold mx-1">-</span>
              % ]
            </div>
            <div>
              [ ã‚²ã‚¹ãƒˆ
              <span id="highlightGuestCount" class="text-xl md:text-2xl font-extrabold mx-1">-</span>
              äºº ]
            </div>
            <div>
              [ å•†è«‡
              <span id="highlightDealCount" class="text-xl md:text-2xl font-extrabold mx-1">-</span>
              ä»¶ ]
            </div>
            <div>
              [ å£²ä¸Š
              <span id="highlightSalesTotal" class="text-xl md:text-2xl font-extrabold mx-1">-</span>
              å†† ]
            </div>
          </div>
        </section>

        <!-- 4ã¤ã®ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ -->
        <section class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
          <div class="bg-white rounded-xl shadow p-4">
            <div class="text-xs text-slate-500 mb-1">å‡ºå¸­</div>
            <div id="attendCount" class="text-2xl font-extrabold text-green-600">-</div>
            <div id="memberCount" class="text-xs text-slate-400 mt-1">ä¼šå“¡æ•° -</div>
          </div>
          <div class="bg-white rounded-xl shadow p-4">
            <div class="text-xs text-slate-500 mb-1">æ¬ å¸­</div>
            <div id="absentCount" class="text-2xl font-extrabold text-red-600">-</div>
          </div>
          <div class="bg-white rounded-xl shadow p-4">
            <div class="text-xs text-slate-500 mb-1">æœªå›ç­”</div>
            <div id="noAnswerCount" class="text-2xl font-extrabold text-slate-400">-</div>
          </div>
          <div class="bg-white rounded-xl shadow p-4">
            <div class="text-xs text-slate-500 mb-2">ä¼šå“¡ãƒãƒƒã‚¸</div>
            <div class="flex flex-col gap-1 text-xs">
              <div class="flex items-center gap-1">
                <span>ğŸ¥‡ ã‚´ãƒ¼ãƒ«ãƒ‰</span>
                <span id="goldCount" class="font-bold">-</span>
                <span>äºº</span>
              </div>
              <div class="flex items-center gap-1">
                <span>ğŸ”´ èµ¤ãƒãƒƒã‚¸</span>
                <span id="redCount" class="font-bold">-</span>
                <span>äºº</span>
              </div>
              <div class="flex items-center gap-1">
                <span>ğŸŸ¢ ç·‘ãƒãƒƒã‚¸</span>
                <span id="greenCount" class="font-bold">-</span>
                <span>äºº</span>
              </div>
            </div>
          </div>
        </section>

        <!-- 2ã‚«ãƒ©ãƒ ï¼šå£²ä¸Š & ã‚²ã‚¹ãƒˆ -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
          <div class="bg-white rounded-xl shadow p-4">
            <h2 class="text-sm font-semibold mb-3">ä¼šå“¡åˆ¥ å£²ä¸Šãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
            <div id="salesRankingBody" class="space-y-2">
              <div class="text-xs text-slate-400">ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...</div>
            </div>
          </div>
          <div class="bg-white rounded-xl shadow p-4">
            <div class="flex items-center justify-between mb-2">
              <h2 class="text-sm font-semibold">ã‚²ã‚¹ãƒˆç”³è«‹çŠ¶æ³</h2>
              <div id="guestSummary" class="text-xs text-slate-500">-</div>
            </div>
            <table class="w-full text-xs md:text-sm">
              <thead>
                <tr class="text-left text-slate-500 border-b">
                  <th class="py-1 pr-2">ã‚²ã‚¹ãƒˆå</th>
                  <th class="py-1 pr-2">ç´¹ä»‹è€…</th>
                  <th class="py-1">æ‰¿èª</th>
                </tr>
              </thead>
              <tbody id="guestListBody">
                <tr>
                  <td colspan="3" class="py-2 text-slate-400">ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
      </div>

      <!-- å‡ºæ¬ ã‚¿ãƒ– -->
<div id="attend-tab" class="tab-panel">
  <section class="bg-white rounded-xl shadow p-4 mt-4">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-sm font-semibold">å‡ºæ¬ ç®¡ç†ï¼ˆè©³ç´°ï¼‰</h2>
      <div class="flex flex-wrap gap-3 text-xs text-slate-500">
        <span>å‡ºå¸­: <span id="attendCountAttend">0 å</span></span>
        <span>æ¬ å¸­: <span id="attendCountAbsent">0 å</span></span>
        <span>æœªå›ç­”: <span id="attendCountNoAnswer">0 å</span></span>
      </div>
    </div>
    <p class="text-xs text-slate-500 mb-3">
      å‡ºå¸­ãƒ»æ¬ å¸­ã¯å›ç­”æ™‚é–“ã®æ—©ã„é †ã«è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚å³å´ã«ã¯ã¾ã å›ç­”ãŒãªã„ä¼šå“¡ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
    </p>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
      <!-- å‡ºå¸­ -->
      <div class="bg-slate-50 border border-slate-200 rounded-xl p-3">
        <h3 class="text-sm font-semibold text-emerald-700 mb-2">âœ… å‡ºå¸­</h3>
        <div id="attendListAttend" class="grid grid-cols-2 gap-2 text-xs md:text-sm"></div>
      </div>

      <!-- æ¬ å¸­ -->
      <div class="bg-slate-50 border border-slate-200 rounded-xl p-3">
        <h3 class="text-sm font-semibold text-red-700 mb-2">âŒ æ¬ å¸­</h3>
        <div id="attendListAbsent" class="grid grid-cols-2 gap-2 text-xs md:text-sm"></div>
      </div>

      <!-- æœªå›ç­” -->
      <div class="bg-slate-50 border border-slate-200 rounded-xl p-3">
        <h3 class="text-sm font-semibold text-slate-700 mb-2">ğŸ•’ æœªå›ç­”</h3>
        <div id="attendListNoAnswer" class="grid grid-cols-2 gap-2 text-xs md:text-sm"></div>
      </div>
    </div>
  </section>
</div>


      <!-- ã‚²ã‚¹ãƒˆã‚¿ãƒ– -->
      <div id="guest-tab" class="tab-panel">
        <section class="bg-white rounded-xl shadow p-4 mt-4">
          <h2 class="text-sm font-semibold mb-2">ã‚²ã‚¹ãƒˆç®¡ç†ï¼ˆè©³ç´°ï¼‰</h2>
          <p class="text-xs text-slate-500">
            ã“ã“ã«ã‚²ã‚¹ãƒˆä¸€è¦§ã‚„ç´¹ä»‹è€…åˆ¥é›†è¨ˆãªã©ã‚’å¾Œã§é…ç½®ã—ã¾ã™ã€‚
          </p>
        </section>
      </div>

      <!-- å£²ä¸Šã‚¿ãƒ– -->
      <div id="sales-tab" class="tab-panel">
        <section class="bg-white rounded-xl shadow p-4 mt-4">
          <h2 class="text-sm font-semibold mb-2">å£²ä¸Šé›†è¨ˆï¼ˆè©³ç´°ï¼‰</h2>
          <p class="text-xs text-slate-500">
            ã“ã“ã«å£²ä¸Šã®è©³ç´°è¡¨ã‚„æœˆæ¬¡æ¨ç§»ãªã©ã‚’å¾Œã§é…ç½®ã—ã¾ã™ã€‚
          </p>
        </section>
      </div>

      <!-- ğŸ” æ›´æ–°ã‚¿ãƒ– -->
      <div id="renew-tab" class="tab-panel">
        <section class="bg-white rounded-xl shadow p-4 mt-4">
          <h2 class="text-sm font-semibold mb-2">æ›´æ–°äºˆå®š</h2>
          <p class="text-xs text-slate-500 mb-3">
            ç¿Œæœˆãƒ»ç¿Œã€…æœˆã«æ›´æ–°ã‚’è¿ãˆã‚‹ä¼šå“¡ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚
          </p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- æ¥æœˆ -->
            <div>
              <div class="flex items-center justify-between mb-2">
                <h3 id="nextMonthLabel" class="text-sm font-semibold text-slate-800">
                  æ¥æœˆæ›´æ–°
                </h3>
                <span id="nextMonthCount" class="text-xs text-slate-500">0 å</span>
              </div>
              <div id="nextMonthContainer" class="grid grid-cols-2 lg:grid-cols-3 gap-2"></div>
            </div>
            <!-- å†æ¥æœˆ -->
            <div>
              <div class="flex items-center justify-between mb-2">
                <h3 id="next2MonthLabel" class="text-sm font-semibold text-slate-800">
                  å†æ¥æœˆæ›´æ–°
                </h3>
                <span id="next2MonthCount" class="text-xs text-slate-500">0 å</span>
              </div>
              <div id="next2MonthContainer" class="grid grid-cols-2 lg:grid-cols-3 gap-2"></div>
            </div>
          </div>
        </section>
      </div>

      <!-- ãƒãƒ¼ãƒ ã‚¿ãƒ– -->
      <div id="team-tab" class="tab-panel">
        <section class="bg-white rounded-xl shadow p-4 mt-4">
          <h2 class="text-sm font-semibold mb-2">ãƒãƒ¼ãƒ æ§‹æˆ</h2>
          <p class="text-xs text-slate-500 mb-3">
            ãƒãƒ¼ãƒ æ¯ã«ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã—ã¦ã„ã¾ã™ã€‚ã©ã“ã«ã‚‚æ‰€å±ã—ã¦ãªã„ä¼šå“¡ã¯ã€Œæœªé…å±ã€ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
          </p>
          <div id="teamContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </section>
      </div>
    </div>
  </div>

  <script>
    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    function setupTabs() {
      const tabButtons = document.querySelectorAll('.tab-btn');
      const tabPanels  = document.querySelectorAll('.tab-panel');

      tabButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
          const targetId = btn.dataset.tab;

          tabButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');

          tabPanels.forEach(panel => {
            if (panel.id === targetId) {
              panel.classList.add('active');
            } else {
              panel.classList.remove('active');
            }
          });
        });
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      setupTabs();
      google.script.run
        .withSuccessHandler(renderDashboard)
        .getDashboardData();
    });

    // ãƒãƒƒã‚¸åˆ¥ã‚¯ãƒ©ã‚¹
    function getBadgeStyle(badge) {
      switch (badge) {
        case 'ã‚´':
          return {
            cardClass: 'member-card member-card--gold'
          };
        case 'æ­£':
          return {
            cardClass: 'member-card member-card--red'
          };
        case 'æº–':
          return {
            cardClass: 'member-card member-card--green'
          };
        default:
          return {
            cardClass: 'member-card member-card--default'
          };
      }
    }

    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æç”»
    function renderDashboard(data) {
      if (!data) return;

      // å¯¾è±¡ä¾‹ä¼š
      document.getElementById('eventName').textContent =
        data.eventName || '-';

      // å‡ºæ¬ ã‚µãƒãƒª
      const att = data.attendance || {};
      document.getElementById('attendCount').textContent   = att.attend   ?? '-';
      document.getElementById('absentCount').textContent   = att.absent   ?? '-';
      document.getElementById('noAnswerCount').textContent = att.noAnswer ?? '-';
      document.getElementById('memberCount').textContent =
        att.memberCount ? `ä¼šå“¡æ•° ${att.memberCount} å` : 'ä¼šå“¡æ•° -';

      const attendNum = att.attend != null ? Number(att.attend) : 0;
      const memberNum = att.memberCount != null ? Number(att.memberCount) : 0;

      // ãƒãƒƒã‚¸é›†è¨ˆ
      const badges = data.badges || {};
      document.getElementById('goldCount').textContent  = badges.gold  ?? '-';
      document.getElementById('redCount').textContent   = badges.red   ?? '-';
      document.getElementById('greenCount').textContent = badges.green ?? '-';

      // å£²ä¸Š
      const sales = data.sales || {};
      const total     = sales.total || 0;
      const dealCount = sales.dealCount || 0;

      const rankingDiv = document.getElementById('salesRankingBody');
      rankingDiv.innerHTML = '';

      if (sales.ranking && sales.ranking.length) {
        sales.ranking.forEach((item, index) => {
          const div = document.createElement('div');
          div.className = 'flex items-center gap-2 text-sm';
          div.innerHTML = `
            <span class="font-bold text-slate-600">${index + 1}ä½</span>
            <span class="text-slate-800">${item.name}</span>
          `;
          rankingDiv.appendChild(div);
        });
      } else {
        rankingDiv.innerHTML =
          '<div class="text-xs text-slate-400">ãƒ‡ãƒ¼ã‚¿ãªã—</div>';
      }

      // ã‚²ã‚¹ãƒˆ
      const guests = data.guests || {};
      const guestSummaryText =
        `ç”³è«‹ ${guests.total || 0} å / æ‰¿èª ${guests.approved || 0} / ä¿ç•™ ${guests.pending || 0}`;
      document.getElementById('guestSummary').textContent = guestSummaryText;

      const tbodyGuest = document.getElementById('guestListBody');
      tbodyGuest.innerHTML = '';

      if (guests.list && guests.list.length) {
        guests.list.forEach(g => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="py-1 pr-2">${g.guestName || ''}</td>
            <td class="py-1 pr-2">${g.introName || ''}</td>
            <td class="py-1">${g.approved ? 'âœ”ï¸' : ''}</td>
          `;
          tbodyGuest.appendChild(tr);
        });
      } else {
        tbodyGuest.innerHTML =
          '<tr><td colspan="3" class="py-2 text-slate-400">ã‚²ã‚¹ãƒˆç”³è«‹ãªã—</td></tr>';
      }

      const guestTotalNum = guests.total != null ? Number(guests.total) : 0;

      // ä»Šæœˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
      let rateDisplay = '-';
      if (attendNum > 0 && memberNum > 0) {
        const rate = Math.round((attendNum / memberNum) * 100);
        rateDisplay = rate;
      }
      document.getElementById('highlightAttendRate').textContent = rateDisplay;
      document.getElementById('highlightGuestCount').textContent  =
        guestTotalNum || '-';
      document.getElementById('highlightDealCount').textContent   =
        dealCount || '-';
      document.getElementById('highlightSalesTotal').textContent  =
        total ? total.toLocaleString() : '-';

      // ===== å‡ºæ¬ è©³ç´°ï¼ˆã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼‰ =====
      const attendanceDetail = data.attendanceDetail || {};
      const attendList   = Array.isArray(attendanceDetail.attendList)   ? attendanceDetail.attendList   : [];
      const absentList   = Array.isArray(attendanceDetail.absentList)   ? attendanceDetail.absentList   : [];
      const noAnswerList = Array.isArray(attendanceDetail.noAnswerList) ? attendanceDetail.noAnswerList : [];

      const colAttend   = document.getElementById('attendListAttend');
      const colAbsent   = document.getElementById('attendListAbsent');
      const colNoAnswer = document.getElementById('attendListNoAnswer');

      const countAttendEl   = document.getElementById('attendCountAttend');
      const countAbsentEl   = document.getElementById('attendCountAbsent');
      const countNoAnswerEl = document.getElementById('attendCountNoAnswer');

      if (countAttendEl)   countAttendEl.textContent   = `${attendList.length} å`;
      if (countAbsentEl)   countAbsentEl.textContent   = `${absentList.length} å`;
      if (countNoAnswerEl) countNoAnswerEl.textContent = `${noAnswerList.length} å`;

      if (colAttend && colAbsent && colNoAnswer) {
        const renderList = (list, container) => {
          container.innerHTML = '';
          if (!list.length) {
            container.innerHTML =
              '<div class="text-xs text-slate-400">è©²å½“è€…ãªã—</div>';
            return;
          }

          list.forEach(item => {
            const style = getBadgeStyle(item.badge);
            const div = document.createElement('div');
            div.className = style.cardClass;
            div.innerHTML = `
              <div class="member-card__name">${item.name}</div>
              ${item.time ? `<div class="text-[10px] text-slate-500 mt-0.5">${item.time}</div>` : ''}
            `;
            container.appendChild(div);
          });
        };

        // å·¦ï¼šå‡ºå¸­
        renderList(attendList, colAttend);

        // ä¸­ï¼šæ¬ å¸­
        renderList(absentList, colAbsent);

        // å³ï¼šæœªå›ç­”ï¼ˆæ™‚é–“è¡¨ç¤ºãªã—ï¼‰
        renderList(noAnswerList, colNoAnswer);
      }

      // ===== æ›´æ–°äºˆå®šï¼ˆç¿Œæœˆãƒ»ç¿Œã€…æœˆï¼‰ =====
      const renewals = data.renewals || {};
      const nextArr  = Array.isArray(renewals.next)  ? renewals.next  : [];
      const next2Arr = Array.isArray(renewals.next2) ? renewals.next2 : [];

      const nextLabelEl  = document.getElementById('nextMonthLabel');
      const next2LabelEl = document.getElementById('next2MonthLabel');
      const nextCountEl  = document.getElementById('nextMonthCount');
      const next2CountEl = document.getElementById('next2MonthCount');
      const nextContainer  = document.getElementById('nextMonthContainer');
      const next2Container = document.getElementById('next2MonthContainer');

      if (nextContainer && next2Container) {
        nextContainer.innerHTML = '';
        next2Container.innerHTML = '';

        // è¦‹å‡ºã—ãƒ©ãƒ™ãƒ«ï¼ˆãã®ã¾ã¾ä½¿ã†ï¼‰
        if (nextLabelEl) {
          nextLabelEl.textContent = renewals.nextMonthLabel || 'æ¥æœˆæ›´æ–°';
        }
        if (next2LabelEl) {
          next2LabelEl.textContent = renewals.next2MonthLabel || 'å†æ¥æœˆæ›´æ–°';
        }

        if (nextCountEl)  nextCountEl.textContent  = `${nextArr.length} å`;
        if (next2CountEl) next2CountEl.textContent = `${next2Arr.length} å`;

        // æ¥æœˆ
        if (nextArr.length === 0) {
          nextContainer.innerHTML =
            '<div class="text-xs text-slate-400">è©²å½“è€…ãªã—</div>';
        } else {
          let hasZeroNext = false;

          nextArr.forEach(m => {
            const style = getBadgeStyle(m.badge);
            const div = document.createElement('div');
            div.className = style.cardClass;

            const displayName = (m.hasZeroReferral ? 'âš ï¸' : '') + m.name;
            if (m.hasZeroReferral) hasZeroNext = true;

            div.innerHTML = `
              <div class="member-card__name">${displayName}</div>
            `;
            nextContainer.appendChild(div);
          });

          // ç´¹ä»‹åœ¨ç±äººæ•° 0 ã®äººãŒã„ã‚‹å ´åˆã€æ³¨æ„æ›¸ãã‚’ä¸€ç•ªä¸‹ã«è¡¨ç¤º
          if (hasZeroNext) {
            const warn = document.createElement('div');
            warn.className = 'col-span-full text-[11px] text-red-600 mt-1';
            warn.textContent = 'âš ï¸ç´¹ä»‹åœ¨ç±äººæ•°ãŒ0äººã§ã™ã€‚';
            nextContainer.appendChild(warn);
          }
        }

        // å†æ¥æœˆ
        if (next2Arr.length === 0) {
          next2Container.innerHTML =
            '<div class="text-xs text-slate-400">è©²å½“è€…ãªã—</div>';
        } else {
          let hasZeroNext2 = false;

          next2Arr.forEach(m => {
            const style = getBadgeStyle(m.badge);
            const div = document.createElement('div');
            div.className = style.cardClass;

            const displayName = (m.hasZeroReferral ? 'âš ï¸' : '') + m.name;
            if (m.hasZeroReferral) hasZeroNext2 = true;

            div.innerHTML = `
              <div class="member-card__name">${displayName}</div>
            `;
            next2Container.appendChild(div);
          });

          if (hasZeroNext2) {
            const warn = document.createElement('div');
            warn.className = 'col-span-full text-[11px] text-red-600 mt-1';
            warn.textContent = 'âš ï¸ç´¹ä»‹åœ¨ç±äººæ•°ãŒ0äººã§ã™ã€‚';
            next2Container.appendChild(warn);
          }
        }
      }

      // ===== ãƒãƒ¼ãƒ è¡¨ç¤ºï¼ˆ1äºº1ã‚«ãƒ¼ãƒ‰ï¼‰ =====
      const teamData = data.teams || { teams: [], unassigned: [] };
      const teamContainer = document.getElementById('teamContainer');
      if (!teamContainer) return;

      teamContainer.innerHTML = '';

      const hasTeams      = Array.isArray(teamData.teams) && teamData.teams.length > 0;
      const hasUnassigned = Array.isArray(teamData.unassigned) && teamData.unassigned.length > 0;

      if (!hasTeams && !hasUnassigned) {
        teamContainer.innerHTML =
          '<div class="text-xs text-slate-400">ãƒãƒ¼ãƒ æƒ…å ±ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>';
        return;
      }

      // ãƒãƒ¼ãƒ ã”ã¨
      if (hasTeams) {
        teamData.teams.forEach(team => {
          const card = document.createElement('div');
          card.className = 'bg-white rounded-xl shadow p-4 border border-slate-200';

          const members = Array.isArray(team.members) ? team.members : [];
          const totalMembers = members.length;

          let membersHtml = '';

          if (totalMembers === 0) {
            membersHtml = '<div class="text-xs text-slate-400">ãƒ¡ãƒ³ãƒãƒ¼æœªç™»éŒ²</div>';
          } else {
            membersHtml = members.map(m => {
              const style = getBadgeStyle(m.badge);
              return `
                <div class="${style.cardClass}">
                  <div class="member-card__name">${m.name}</div>
                </div>
              `;
            }).join('');
          }

          card.innerHTML = `
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-sm font-semibold text-slate-800">${team.teamName || 'ãƒãƒ¼ãƒ åæœªè¨­å®š'}</h3>
              <span class="text-xs text-slate-500">${totalMembers} å</span>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
              ${membersHtml}
            </div>
          `;
          teamContainer.appendChild(card);
        });
      }

      // æœªé…å±
      if (hasUnassigned) {
        const card = document.createElement('div');
        card.className =
          'bg-white rounded-xl shadow p-4 border border-dashed border-amber-300';

        const members = teamData.unassigned;
        const totalMembers = members.length;

        let membersHtml = '';

        if (totalMembers === 0) {
          membersHtml = '<div class="text-xs text-amber-400">æœªé…å±ãƒ¡ãƒ³ãƒãƒ¼ãªã—</div>';
        } else {
          membersHtml = members.map(m => {
            const style = getBadgeStyle(m.badge);
            return `
              <div class="${style.cardClass}">
                <div class="member-card__name">${m.name}</div>
              </div>
            `;
          }).join('');
        }

        card.innerHTML = `
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-sm font-semibold text-amber-800">æœªé…å±</h3>
            <span class="text-xs text-amber-700">${totalMembers} å</span>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
            ${membersHtml}
          </div>
        `;
        teamContainer.appendChild(card);
      }
    }
  </script>
</body>
</html>
