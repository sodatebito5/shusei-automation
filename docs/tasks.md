# タスク管理

> チェックボックスで進捗管理。完了したら `[x]` に変更。
>
> **Claude Code ルール**:
> - タスク着手前にこのファイルを確認
> - 完了時は該当タスクを `[x]` に更新
> - 新規タスク発生時はバックログに追加
> - 完了タスクは「✅ 完了」セクションに移動

---

## 🔥 進行中

### [バグ] 会員編集の保存が完了しない問題
- [ ] 原因調査（Playwrightでデバッグ中）
- [ ] 保存ボタン押下後、成功メッセージが表示されない
- [ ] 変更履歴記録は一時的にコメントアウト中
- [ ] GASのログ確認が必要

### 会員変更履歴機能
- [x] 出欠確認シートに「会員変更履歴」シート作成
- [x] logMemberChange_() ヘルパー関数実装
- [x] updateMember(), addMember(), retireMember() に履歴記録を組み込み
- [ ] 動作確認（上記バグ解決後）

### 式次第機能
- [ ] PDF生成（レイアウト調整）

### チェックイン機能（例会当日用）
- [x] Phase 1: データ基盤 - GAS API追加
  - setupCheckinColumns(): 受付名簿に列追加
  - doCheckin(): チェックイン実行（LIFF用）
  - getCheckinStatus(): 全員のステータス取得（ダッシュボード用）
  - updateCheckinField(): フィールド更新
  - manualCheckin(): 手動チェックイン
- [x] Phase 2: ダッシュボードUI
  - 例会当日タブ → チェックイン管理画面
  - 到着/未到着/バッジ未返却フィルタ
  - バッジ貸出・返却チェック
  - 領収書番号入力
- [x] Phase 3: チェックインLIFF作成
  - web/checkin/index.html 作成
  - LIFF SDK連携
- [ ] Phase 4: 本番セットアップ
  - LINE Developers ConsoleでLIFF ID発行
  - web/checkin/index.htmlのLIFF_IDを更新
  - Cloudflare Pagesにデプロイ
  - GASエディタでsetupCheckinColumns()を1回実行

---

## 📋 バックログ（未着手）

### 配席アーカイブ読み込み機能

#### 概要
配席アーカイブから過去の配席情報を読み込み、途中から配席を再開・編集できる機能

#### ユースケース
- 前回の配席をベースに微調整したい
- 配席作業を中断して後で再開したい
- 過去の配席パターンを参考にしたい

#### タスク
- [ ] 配席アプリ: アーカイブ選択UI追加
- [ ] 配席アプリ: アーカイブデータを座席表に読み込む処理
- [ ] 配席アプリ: 「読み込み」ボタン追加
- [ ] 読み込み時の差分処理（新規参加者・欠席者の扱い）

#### データソース
- 配席アーカイブシート（ダッシュボードGAS）
  - A列: eventKey
  - D列: 氏名
  - E列: 区分
  - F列: 所属
  - I列: テーブル

#### 注意点
- アーカイブ読み込み後、現在の参加者リストとの差分を表示
- 新規参加者は未配席として追加
- 欠席者は座席から除外（警告表示）

---

### Googleフォーム経由の他会場参加登録

#### 概要
HP上のGoogleフォームから他会場参加者の情報を出欠確認シートに反映する機能

#### フォームURL（新規作成済）
https://docs.google.com/forms/d/e/1FAIpQLScbjVLeSyfusz_b9ANvDL-5win-w8_G0TGxQ7TOW8hplRYqGw/viewform

#### 出力先
出欠確認シート → フォームの回答シート（自動連携済）

#### タスク
- [x] フォーム自動作成（createOtherVenueFormV4）
- [x] 会場マスターから所属会場リスト取得
- [x] 設定シートD列から例会日程取得（直近3回）
- [x] フォーム回答のスプレッドシート連携設定
- [x] 他会場名簿マスターへの転記処理（syncFormResponsesToOtherVenueMaster実装）
- [x] ダッシュボード他会場タブとの連携確認（フォーム同期ボタン追加）

#### 関連
- 他会場タブ
- ダッシュボード連携

---

### 役割分担編集ページ（追加機能）

#### 残りタスク
- [ ] 式次第との連携（担当者名を自動反映）

---

### 参加者名簿の印刷設定
- [ ] 印刷レイアウト調整（A4横・余白設定）
- [ ] フォントサイズ最適化
- [ ] ページ分割処理の改善

---

### スケジュール管理
- [ ] 基本CRUD実装
- [ ] ダッシュボードとの連携

---

### インフラ・共通
- [ ] エラー通知の仕組み
- [ ] ログ出力整備
- [ ] 引き継ぎドキュメント作成

---

### UIデザインの刷新

#### 概要
ダッシュボード全体のUIを刷新し、より使いやすく見やすいデザインに改善

#### タスク
- [ ] カラースキーム・テーマの統一
- [ ] タブUIの改善（アイコン・レイアウト）
- [ ] カード・テーブルデザインの統一
- [ ] モバイル対応（レスポンシブ）の改善
- [ ] ローディング・エラー表示の統一
- [ ] フォント・余白の調整

---

## ✅ 完了

### 2026-01-31
- [x] **出欠リマインド送信機能**
  - ダッシュボード出欠管理タブに「出欠リマインド管理」ボタン追加済み
  - GAS API: getUnrespondedMembersForReminder(), sendAttendanceReminder(), sendAttendanceReminderDryRun()
  - 未回答者を会員名簿マスター×出欠状況から自動抽出
  - LINE送信可能/未登録で分けて表示
  - テスト実行（ドライラン）機能
  - 本番送信（確認ダイアログ付き）
  - 送信結果表示
  - 設定シートJ2セル: 回答期限（オプション、未設定時は開催日前日）
- [x] **連絡網グループ表示機能**
  - GAS API: getContactGroups()
  - 専用ページ contact.html（?page=contact でアクセス）
  - 会員名簿マスター AB列（グループ）、AC列（リーダーフラグ）、AD列（連絡網順序）を使用
  - グループ別にリーダー＋メンバー一覧表示
  - 印刷対応（A4横向き、2カラムレイアウト）
  - スマホ対応UI

### 2026-01-30
- [x] **入会日フィールド表示バグ修正**
  - 編集モーダルの入会日が空白で表示される問題を修正
  - formatDate_()の出力形式をYYYY/MM/DD→YYYY-MM-DDに変更
  - HTML input[type="date"]はハイフン区切りを要求するため
- [x] **会員変更履歴シート作成**
  - 出欠確認シートに「会員変更履歴」シートを追加
  - 列構成: 変更日時/操作種別/会員ID/会員名/変更項目/変更前/変更後
  - logMemberChange_() 関数で自動記録
  - 編集/新規追加/退会の3種類の操作を記録
- [x] **会員名簿編集機能（Phase 1）**
  - GAS API: getMembersForEdit(), updateMember(), addMember(), retireMember(), verifyMemberEditPassword()
  - ダッシュボード「会員管理」タブ追加
  - カード形式の会員一覧表示
  - 検索・フィルタ機能（名前、チーム、バッジ、更新月）
  - 編集モーダル（全項目編集対応）
  - パスワード保護（設定シートK2セル）
  - 新規会員追加（会員ID自動採番）
  - 退会処理（AA列に論理削除フラグ）
  - スマホ対応UI

### 2026-01-14
- [x] **役割分担編集機能（基本実装）**
  - API: getRoleAssignments(), saveRoleAssignments() 実装
  - 役割分担タブ追加（ダッシュボード）
  - カード形式UI（担当者名入力）
  - イベント単位でデータ保存
  - 役割: 統括、PA、MC x2、バッジ授与、受付 x4、ゲスト誘導 x4、会員サポート x4、名刺回収 x4、撮影
- [x] **役割分担ページ モバイル最適化**
  - 表示ページ: カード形式・大きなフォント・アイコン付き
  - 編集ページ: 大きなタッチターゲット・交互背景色・番号表示
- [x] **役割分担保存バグ修正**
  - HTMLテンプレートの改行によるdata-role-id属性破損を修正
  - GASパラメータ渡し方式を変更（eventKey, assignmentsを分離）
  - 3人目以降の担当者が保存されない問題を解決
- [x] **例会当日ページ イベントキー独立化**
  - 設定シートI2セル（例会当日イベントキー）を参照
  - 他ページ（概要・出欠等）とは独立して制御可能に
  - テーブルマスター表でテーブル記号が空欄のものを非表示
- [x] **式次第機能（PDF生成以外）**
  - プレビュー画面実装
  - 項目並び替え機能
  - 編集機能（時間・担当者など）
  - Sheetsからの自動データ取得
- [x] **履歴タブ追加**
  - getEventKeyList(), getParticipantHistory() API実装
  - 例会選択ドロップダウン
  - 参加者一覧（会員/ゲスト/他会場フィルタ付き）
  - サマリー表示（合計・区分別人数）
- [x] **個別売上機能**
  - パスワード認証付き売上詳細表示
  - 月別切り替え
  - getSalesMonthList(), getIndividualSales() API
- [x] **売上eventKeyフォーマット変更対応**
  - 「11月_売上報告」→「2025年11月_売上報告」形式に対応
  - getTeamSalesRanking(), aggregateSales_() 等を修正
- [x] **出欠アプリ eventKey判定修正**
  - userId + eventKey の両方で一致判定
  - eventKey変更時は新規行追加

### 2026-01-13
- [x] **イベントキー自動切り替えシステム**
  - 設定シートF列・G列追加（次月イベントキー・次月開催日）
  - 共通関数: getEventSettings(), getDashboardEventKey(), getAttendanceEventKey()
  - 切り替えタイミング: ダッシュボード11:00、出欠/ゲスト12:00
  - H2セル: 出欠専用イベントキー（オーバーライド用）
- [x] ゲスト申請: イベント選択UI → バックエンド自動取得に変更
- [x] 出欠アプリ: LINE通知を無効化

### 2026-01-12
- [x] **コア機能完了**
  - 出欠連絡（LIFF実装・本番運用中）
  - 売上報告（LIFF実装・本番運用中）
  - ゲスト申請（LIFF実装・本番運用中）
  - 自動配席（本番運用中）
- [x] **配席アプリ再設計 Phase 1-5**
  - getSeatingParticipants(), syncSeats(), listSeatingArchives() 実装
  - 配席アーカイブ機能
  - 受付名簿への座席反映
- [x] **バグ修正**
  - ゲストが「他会場」扱いになるバグ修正
  - ID重複バグ修正（guest_/other_ プレフィックス追加）
  - syncSeats ヘッダー行インデックス修正
- [x] GASプロジェクト統合（守成ダッシュボード_v3 に一本化）
- [x] docs/SYSTEM_CONFIG.md 作成
- [x] 自動配席アプリ本番デプロイ（seat-maker2.pages.dev）
- [x] ダッシュボードに配席リンク追加
- [x] ダッシュボード連携（API整備・テスト完了）

### 過去
- [x] CLAUDE.md, PROGRESS.md, docs/ 作成
- [x] 出欠・売上・ゲスト LIFF 初期実装
- [x] 自動配席 API 実装
- [x] プロジェクト構造整理

---

## 🏷 ラベル凡例

- `[重要]` - 優先度高
- `[ブロック]` - 他タスク待ち
- `[調査]` - 調査・検証が必要
- `[バグ]` - 不具合修正
