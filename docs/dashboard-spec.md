# 守成クラブ 福岡飯塚 ダッシュボード - 仕様書

## 概要

守成クラブ福岡飯塚の例会運営を支援する管理ダッシュボード。
属人・手作業に依存した例会運営を、仕組みで自然に流れる業務に置き換える。

**設計方針**: 「判断は人、処理は仕組み」

---

## KGI / KPI（参照: Obsidian KPI・KGI.md）

**KGI**: 引き継ぎ1時間以内、属人作業90%排除

**KPI**: 月間作業時間 130分 → 15分（88%削減）

| 作業 | Before | After |
|------|--------|-------|
| 出欠転記 | 30分 | 0分 |
| ゲスト情報整理 | 20分 | 0分 |
| 受付表作成 | 30分 | 5分 |
| 売上報告集計 | 20分 | 0分 |

---

## 設計ドキュメント（Obsidian）

Yohaku-Vault `03_守成クラブ/設計/` で管理:
- `業務俯瞰.md` → AS-IS/TO-BE、MVPスコープ
- `ダッシュボード.md` → アーキテクチャ設計書
- `KPI・KGI.md` → 成果指標

---
## システム全体像

### LINE公式アカウント【守成クラブ福岡飯塚】

福岡飯塚会員全員が友だち登録済み。userIdを取得・管理。

**リッチメニュー構成**:

| No | メニュー | 遷移先 | データ保存先 |
|----|----------|--------|--------------|
| 1 | 守成クラブ福岡飯塚HP | HP | - |
| 2 | 例会出欠 | LIFFアプリ | 出欠状況（自動）シート |
| 3 | 売上報告 | LIFFアプリ | 売上報告シート |
| 4 | ゲスト申請 | LIFFアプリ | ゲスト状況（自動）シート |
| 5 | 会員紹介 | HP | - |

### システム構成図
```
┌─────────────────────────────────────────────────────────┐
│                LINE公式アカウント                        │
│                【守成クラブ福岡飯塚】                     │
└─────────────────┬───────────────────────────────────────┘
                  │ リッチメニュー
    ┌─────────────┼─────────────┬─────────────┐
    ▼             ▼             ▼             ▼
┌────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐
│例会出欠 │  │売上報告   │  │ゲスト申請 │  │自動配席   │
│ LIFF   │  │ LIFF     │  │ LIFF     │  │（独立）   │
└────┬───┘  └────┬─────┘  └────┬─────┘  └────┬─────┘
     │           │             │             │
     ▼           ▼             ▼             │
┌─────────────────────────────────────────┐  │
│         Google スプレッドシート          │  │
│  ・出欠状況（自動）                      │  │
│  ・売上報告シート                        │  │
│  ・ゲスト状況（自動）                    │  │
└─────────────────┬───────────────────────┘  │
                  │                          │
                  ▼                          │
┌─────────────────────────────────────────┐  │
│      管理ダッシュボード（GAS）           │◀─┘
│      ※将来的に連携                       │
└─────────────────────────────────────────┘
```

---

## 関連システム

### 管理ダッシュボード（このリポジトリ）

| 項目 | 内容 |
|------|------|
| 用途 | 例会運営の集計・管理・資料作成 |
| 技術 | GAS + HTML + Tailwind CSS |
| 本番 | v2（稼働中） |
| 開発 | v3（このリポジトリ） |

### LIFFアプリ群

| アプリ | 用途 | 現在の場所 |
|--------|------|------------|
| 例会出欠 | 出欠回答 | 別リポジトリ |
| 売上報告 | 月次売上入力 | 別リポジトリ |
| ゲスト申請 | ゲスト情報登録 | 別リポジトリ |

### 自動配席アプリ

| 項目 | 内容 |
|------|------|
| 用途 | 例会の座席並び替え |
| ホスティング | Cloudflare Pages |
| 連携状況 | 現在は独立 |

---

## 将来構想

**目標**: 全システムを1つのVSCode（リポジトリ）に集約
```
shusei-system/
├── dashboard/      # 管理ダッシュボード（GAS）
├── liff/
│   ├── attendance/ # 例会出欠
│   ├── sales/      # 売上報告
│   └── guest/      # ゲスト申請
├── seating/        # 自動配席アプリ
└── docs/           # ドキュメント
```

**連携イメージ**:
- 出席者データ → 自動配席アプリに渡す
- 座席表 → ダッシュボードに表示
- 受付名簿に座席番号を自動反映

---

## 技術構成（ダッシュボード）

| 項目 | 内容 |
|------|------|
| フロントエンド | HTML + Tailwind CSS + Chart.js |
| バックエンド | Google Apps Script |
| データ | Google スプレッドシート |
| PDF生成 | html2canvas + jsPDF |

---

## スプレッドシート構成

### 出欠確認シート（ID: `1IPyjDi3uD-pSxtkF9JK7Uc5isi4lNw6nQKpv9hWUvic`）

| シート名 | 用途 |
|----------|------|
| 会員名簿マスター | 会員情報（氏名、バッジ、チーム、userId等） |
| 出欠状況（自動） | LIFFからの出欠回答 |
| ゲスト出欠状況（自動） | ゲスト申請データ |
| 他会場名簿マスター | 他会場からの参加者 |
| タイムテーブルマスター | 式次第のタイムテーブル・お知らせ |

### 設定シート（ID: `1R4GR1GZg6mJP9zPX5MTE0IsYEAdVLNIM314o7vBqrg8`）

| シート名 | 用途 |
|----------|------|
| 設定 | 現在の例会キー（A2）、開催日（D2） |
| ダッシュボード集計 | キャッシュ用JSON |
| 月次サマリー | 月別集計データ（グラフ用） |

### 売上報告シート（ID: `1QYLHr7wMj0jQW5ApgWf-l1Bk9_9M5EV54FDHQp2Rkic`）

| シート名 | 用途 |
|----------|------|
| sales | 売上報告データ |

---

## 画面構成（タブ）

| タブ | 機能 |
|------|------|
| 📊 概要 | 参加ハイライト、売上ハイライト、ゲスト一覧 |
| ✅ 出欠 | 出席・欠席・未回答の会員一覧 |
| 👥 ゲスト | ゲスト詳細情報 |
| 🏢 他会場 | 他会場からの参加者一覧 |
| 💰 売上 | 月別推移グラフ、累計表示 |
| 🧩 チーム | チーム別会員一覧 |
| 🔁 更新 | 翌月・翌々月の更新予定者 |
| 📋 例会事前準備 | 参加者名簿、受付名簿、式次第 |
| 📅 例会当日 | 役割分担、チェックイン（準備中） |

---

## 主要GAS関数

### データ取得

| 関数名 | 用途 |
|--------|------|
| `getDashboardDataFast()` | ダッシュボード全データ（キャッシュ版） |
| `getDashboardData()` | ダッシュボード全データ（直接取得） |
| `getEventDayData()` | 例会当日データ（役割分担） |
| `getReceptionRosterData()` | 受付名簿データ |
| `getShikidaiData()` | 式次第データ |

### データ保存

| 関数名 | 用途 |
|--------|------|
| `saveTimeTableData(data)` | タイムテーブル・お知らせ保存 |

### キャッシュ更新

| 関数名 | 用途 |
|--------|------|
| `updateDashboardCache()` | 集計データをキャッシュ（5分トリガー） |

---

## 式次第機能

### データ構造

**タイムテーブルマスター シート**:
- A〜D列: 時間、項目、担当者、備考
- F〜G列: お知らせ種別、内容

**お知らせ種別**:
- 来月案内
- キャンセル
- 設営案内
- ゲスト連絡先
- 他会場連絡先
- 車座補足
- 懇親会補足

### 画面

1. **編集画面**: タイムテーブル行の追加・削除・編集、お知らせ編集
2. **プレビュー画面**: 印刷用レイアウト

---

## 共通ルール

### 例会回の計算

- 基準: 2025年9月例会 = 第89回
- 計算: `(year - 2025) * 12 + (month - 9) + 89`

### バッジ種別

| 記号 | 種別 | 色 |
|------|------|-----|
| ゴ | ゴールド | 金（#ca8a04） |
| 正 | 正会員 | 赤（#b91c1c） |
| 準 | 準会員 | 緑（#166534） |

---

## 開発ルール

1. **仕様変更**: Obsidianで検討 → このファイルに反映
2. **実装**: VSCodeで編集 → `clasp push`
3. **デプロイ**: 「デプロイを管理」でバージョン更新（URLは変えない）
4. **v2反映**: 手動コピー