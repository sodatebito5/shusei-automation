# エラー解決履歴

> 遭遇したエラーと解決方法を記録。同じミスを繰り返さない。
>
> **Claude Code ルール**:
> - エラー発生時、まずこのファイルで類似ケースを検索
> - 解決後は必ずこのファイルに追記
> - 「よくあるエラーパターン」は特に注意

---

## 📝 記録フォーマット

```markdown
### [日付] エラー概要

**状況**: どこで何をしたときに発生したか
**エラー内容**: エラーメッセージ or 症状
**原因**: 判明した原因
**解決方法**: 何をしたら直ったか
**教訓**: 今後気をつけること
```

---

## 🐛 エラー履歴

### [テンプレート] サンプルエラー

**状況**: GASでSheets API呼び出し時
**エラー内容**: `Exception: サービス Sheets は使用できません`
**原因**: Advanced Google Services が有効化されていなかった
**解決方法**: GASエディタ → サービス → Sheets API を追加
**教訓**: 新しいプロジェクトでは最初にサービス有効化を確認

---

<!-- 以下、実際のエラーを追記 -->

### [2026-01-30] 入会日フィールドが空白で表示される

**状況**: 会員管理タブの編集モーダルで「入会日」フィールドを表示
**エラー内容**: 入会日が空白で表示される（日付が選択できない状態）
**原因**: HTMLの`<input type="date">`は`YYYY-MM-DD`形式（ハイフン区切り）を要求するが、`formatDate_`関数は`YYYY/MM/DD`形式（スラッシュ区切り）で出力していた
**解決方法**: `gas/dashboard/dashboard.js`の`formatDate_`関数を修正
- `yyyy/MM/dd` → `yyyy-MM-dd`
- スラッシュ区切り → ハイフン区切り
**教訓**:
- HTMLの`<input type="date">`はISO 8601形式（YYYY-MM-DD）のみ受け付ける
- 日付フォーマットは使用先の要件を確認してから実装

---

### [2026-01-29] Google Sheets シート誤削除事故

**状況**: MCP経由で「定義」シートを削除しようとした
**エラー内容**: 「出欠状況（自動）」シートが削除された（意図しないシート）
**原因**: `deleteSheet` で sheetId: 0 を確認せず推測で使用。sheetId: 0 は「定義」ではなく「出欠状況（自動）」だった
**解決方法**: スプレッドシートの変更履歴から復元
**教訓**:
- シート削除前に必ずメタデータ取得で sheetId を確認
- sheetId は推測しない（0 が最初のシートとは限らない）
- 破壊的操作は特に慎重に

---

### [YYYY-MM-DD] （タイトル）

**状況**:
**エラー内容**:
**原因**:
**解決方法**:
**教訓**: 

---

## 🔖 よくあるエラーパターン

### LIFF系

| エラー | 原因 | 対処 |
|--------|------|------|
| `INIT_FAILED` | LIFF ID間違い or ドメイン未登録 | LINE Developers でエンドポイント確認 |
| `getProfile() 失敗` | init完了前に呼んでる | `liff.ready` 後に呼ぶ |

### GAS系

| エラー | 原因 | 対処 |
|--------|------|------|
| `シートが見つかりません` | シート名変更 or タイポ | 定数ファイルとシート名を照合 |
| `権限がありません` | 実行ユーザーの権限不足 | デプロイ設定を「自分として実行」に |
| `タイムアウト` | 処理が6分超え | 分割処理 or トリガー利用 |

### PDF生成系

| エラー | 原因 | 対処 |
|--------|------|------|
| レイアウト崩れ | フォント / 余白の差異 | 実機で印刷プレビュー確認 |
| 文字化け | フォント未対応 | 日本語フォント明示指定 |
